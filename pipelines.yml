resources:      
  - name: buildInfo
    type: buildInfo
    version:
      buildName: native_pipeline
      buildNumber: 8
      targetRepo: docker-local
      
pipelines:
  - name: ankul_pipeline
    steps:
      - name: bundle
        type: CreateReleaseBundle
        configuration:
          affinityGroup: test
          nodePool: ankul_nodes
          releaseBundleName: test_2
          releaseBundleVersion: v1.0.8
          dryRun: false
          description: "some random test description"
          releaseNotes:
            syntax: plain_text
            content: "some random content release dasd asdas dasd aasdas"
        execution:
          onComplete:
            - printenv
            - >
  releaseNotesContent=$(jq -r ".step.configuration.releaseNotes.content" $STEP_JSON_PATH)
  if [ ! -z "$releaseNotesContent" ] && [ "$releaseNotesContent" != "null" ]; then
    releaseNotes='{}'
    releaseNotes=$(echo $releaseNotes | jq --arg content $releaseNotesContent '. + {content: $content}')
    releaseNotesSyntax=$(jq -r ".step.configuration.releaseNotes.syntax" $STEP_JSON_PATH)
    if [ ! -z "$releaseNotesSyntax" ] && [ "$releaseNotesSyntax" != "null" ]; then
      releaseNotes=$(echo $releaseNotes | jq --arg syntax $releaseNotesSyntax '. + {syntax: $syntax}')
    fi
    payload=$(echo $payload | jq --argjson json "$releaseNotes" '.release_notes = $json')
  fi
        requires:
          integrations:
            - ankul_artifactory         
        triggeredBy:
          resources:
            - buildInfo
